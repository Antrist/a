all: gridss_cport test

CC = @CC@
CPPFLAGS = @CPPFLAGS@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@

HTSLIB_CPPFLAGS = @HTSLIB_CPPFLAGS@
HTSLIB_LDFLAGS = @HTSLIB_LDFLAGS@

COBJ = \
	gridss_cport.o \
	extractFragmentsToFastq.o \
	unmappedSequencesToFastq.o \
	fastq.o 

TEST_DIR = ../../../test/resources/

gridss_cport: $(COBJ)
	$(CC) $(HTSLIB_LDFLAGS) $(LDFLAGS) -o $@ $(COBJ) -lhts $(LIBS) -lz

test: testUnmappedSequencesToFastq

testUnmappedSequencesToFastq: gridss_cport
	./gridss_cport unmappedSequencesToFastq $(TEST_DIR)/unmappedSequencesToFastq/in.sam > testUnmappedSequencesToFastq.out
	diff $(TEST_DIR)/unmappedSequencesToFastq/out.fq testUnmappedSequencesToFastq.out > testUnmappedSequencesToFastq.diff

extractFragmentsToFastq.o: fastq.h
unmappedSequencesToFastq.o: fastq.h
fastq.o: fastq.h

.SUFFIXES: .c .o

.c.o:
	$(CC) $(CFLAGS) $(HTSLIB_CPPFLAGS) $(CPPFLAGS) -c -o $@ $<

clean:
	-rm -f *.o gridss_cport

distclean: clean
	-rm -f config.log config.status configure Makefile
	-rm -rf autom4te.cache

.PHONY: all clean distclean test testUnmappedSequencesToFastq
